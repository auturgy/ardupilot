# hw definition file for processing by chibios_pins.py
# for anyFC F7 hardware 
# https://github.com/sambas/hw/blob/master/AnyFCF7/AnyFCmedF7final.pdf.
@ thanks to sambas for the open source hardware and schematics
# baro is MS5611 on I2C4 if fitted (mine missing)
# mag not fitted - on I2C2 if connected
# gps makes sense on UART7 as closest to I2C2
# telem 1 makes sense on UART2
# telem2 makes sense on UART8
# imu is mpu6000 on SPI2
# sd card on SPI4
# serial console UART1 

# MCU class and specific type
MCU STM32F7xx STM32F745xx

define CONFIG_HAL_BOARD_SUBTYPE HAL_BOARD_SUBTYPE_CHIBIOS_ANYFCF7

# board ID for firmware load
APJ_BOARD_ID 83

# crystal frequency, setup to use external oscillator
OSCILLATOR_HZ 8000000

define STM32_LSECLK   32768U
define STM32_LSEDRV   (3U << 3U)

define STM32_PLLSRC     STM32_PLLSRC_HSE
define STM32_PLLM_VALUE 8
define STM32_PLLN_VALUE 432
define STM32_PLLP_VALUE 2
define STM32_PLLQ_VALUE 9

FLASH_SIZE_KB 1024
FLASH_RESERVE_START_KB 0

FLASH_SIZE_KB 1024
FLASH_RESERVE_START_KB 0

# board voltage
STM32_VDD 330U

# serial port for stdout
STDOUT_SERIAL SD1
STDOUT_BAUDRATE 57600

# USB setup
#USB_VENDOR
#USB_PRODUCT
USB_STRING_MANUFACTURER "AnyFC"
USB_STRING_PRODUCT "AnyFC F7 FMU"
USB_STRING_SERIAL  "%SERIAL%"


# I2C setup
# I2C_ORDER I2C2 I2C4 #ext then int - no i2c devices fitted for test

# order of UARTs (and USB)
UART_ORDER OTG1 UART1 # enable USB and console only to start with

# PIN ASSIGNMENT
#PA0 PWM(7) TIM5_CH1 TIM5 TIM2_CH1 TIM2 # ALSO LABELLED UART 4??
#PA1 PWM(2) TIM5_CH2 TIM5 TIM2_CH2 TIM2 # ALSO LABELLED UART 4??
#PA2 PWM(6) TIM2_CH3 TIM2 TIM5_CH3 TIM5 # ALSO LABELLED UART 2??
#PA3 PWM(1) TIM2_CH4 TIM2 TIM5_CH4 TIM5 # ALSO LABELLED UART 2??
PA4 MPU6000_CS CS
PA5 SPI1_SCK SPI1
PA6 SPI1_MISO SPI1
PA7 SPI1_MOSI SPI1
#PA8 NC TIM1_CH1 TIM1
PA9  UART1_TX UART1 TIM1_CH2 TIM1 #CONSOLE
PA10 UART1_RX UART1 TIM1_CH3 TIM1 #CONSOLE
PA11 OTG_FS_DM OTG1
PA12 OTG_FS_DP OTG1
PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD
#PA15 NC

#PB0 NC TIM3_CH3 TIM3
#B1 NC TIM3_CH4 TIM3
#PB2 NC
#PB3 PWM(8) TIM2_CH2 TIM2
#PB4 PWM(9) TIM3_CH1 TIM3
#PB5 PWM(4) TIM3_CH2 TIM3
#PB6 TIM4_CH1 TIM4 # LED1 - UART1 TRAFFIC - RED
PB7 FMU_LED_AMBER OUTPUT TIM4_CH2 TIM4 # LED2 - ACTUALLY BLUE ON THIS BOARD
#LED3 IS GREEN - POWER ON INDICATOR. NOT CONNECTED TO MCU
#PB8 PWM(10) TIM4_CH3 TIM4
#PB9 PWM(5) TIM4_CH4 TIM4
PB10 I2C2_SCL I2C2
PB11 I2C2_SDA I2C2
#PB12 CAN2_RX CAN2 #NC I THINK
#PB13 CAN2_TX CAN2 #NC I THINK
PB14 PPM_IN TIM12_CH1 TIM12
#PB15 GPIO TIM12_CH2 TIM12

#PC0 BATT_VOLTAGE_SENS ADC0 SCALE(1) #10k/1k divider
#PC1 BATT_CURRENT_SENS ADC1 SCALE(1) #1k inline resistor
#PC2 RSSI_ADC ADC2 SCALE(1) #1k inline resistor
#PC3 INVERTER
PC4 MPU_DRDY INPUT
#PC5 BARO_CS #FROM SCHEMATIC - CONFUSING AS BARO IS ON I2C AND MISSING FROM MY BOARD
#PC6 UART6_TX UART6 TIM3_CH1 TIM3 TIM8_CH1 TIM8
#PC7 UART6_RX UART6 TIM3_CH2 TIM3 TIM8_CH2 TIM8
#PC8 GPIO TIM3_CH3 TIM3 TIM8_CH3 TIM8
#PC9 GPIO TIM3_CH4 TIM3 TIM8_CH4 TIM8
#PC10 UART4_TX UART4 #SPI3_CLK SPI3
#PC11 UART4_RX UART4 #SPI3_MISO SPI3
#PC12 UART5_TX UART5 #SPI3_MOSI SPI3
#PC13 NC
#PC14 NC
#PC15 NC

PD0 CAN1_RX CAN1
PD1 CAN1_TX CAN1
#PD2 UART5_RX UART5
#PD3 CD #NOT SURE WHAT CD MEANS
#PD4 NC
#PD5 UART2_TX UART2
#PD6 UART2_RX UART2
#PD7
#PD8 UART3_TX UART3
#PD9 UART3_RX UART3
#PD10
#PD11
#PD12 I2C4 SCL TIM4_CH1 TIM4 #BARO MS5611 MISSING FROM MY BOARD
#PD13 I2C4 SDA TIM4_CH2 TIM4 #BARO MS5611 MISSING FROM MY BOARD
#PD14 NC TIM4_CH3 TIM4
#PD15 NC TIM4_CH4 TIM4

#PE0 UART8_RX UART8
#PE1 UART8_TX UART8
#PE2 N$5 #DONT KNOW WHAT THIS MEANS
#PE3 NC
#PE4 N$4 #DONT KNOW WHAT THIS MEANS
#PE5 N$3 #DONT KNOW WHAT THIS MEANS
#PE6 PWM(3) TIM9_CH2 TIM9
PE7 UART7_RX UART7
PE8 UART7_TX UART7
#PE9 NC
#PE10 NC
# SDCARD ON SPI4
#PE11 EXTRA_CS2 CS
#PE12 SPI4_SCK SPI4
#PE13 SPI4_MISO SPI4
#PE14 SPI4_MOSI SPI4
#PE15 NC

define STM32_LSECLK   32768U
define STM32_LSEDRV   (3U << 3U)

# spi devices
SPIDEV MPU6000 SPI1 DEVID2 MPU6000_CS MODE3  1*MHZ  4*MHZ

#HOW TO DEFINE SDCARD ON SPI4

